<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>排序算法可视化对比</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f0f0;
        }
        .controls {
            margin: 20px 0;
        }
        .visualizations {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .algorithm {
            margin: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .array-container {
            display: flex;
            align-items: flex-end;
            height: 200px;
            width: 200px;
        }
        .bar {
            flex: 1;
            background-color: #3498db;
            margin: 0 1px;
            position: relative;
        }
        .bar span {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
        }
    </style>
</head>
<body>
    <h1>排序算法可视化对比</h1>
    <div class="controls">
        <label for="arraySize">数组大小：</label>
        <input type="number" id="arraySize" min="5" max="50" value="20">
        <label for="animationSpeed">动画速度：</label>
        <input type="range" id="animationSpeed" min="1" max="1000" value="500">
        <button onclick="initArrays()">重置数组</button>
        <button onclick="startSort()">开始排序</button>
    </div>
    <div class="visualizations">
        <div class="algorithm">
            <h2>快速排序</h2>
            <div id="quickSortArray" class="array-container"></div>
        </div>
        <div class="algorithm">
            <h2>冒泡排序</h2>
            <div id="bubbleSortArray" class="array-container"></div>
        </div>
        <div class="algorithm">
            <h2>插入排序</h2>
            <div id="insertionSortArray" class="array-container"></div>
        </div>
        <div class="algorithm">
            <h2>选择排序</h2>
            <div id="selectionSortArray" class="array-container"></div>
        </div>
        <div class="algorithm">
            <h2>归并排序</h2>
            <div id="mergeSortArray" class="array-container"></div>
        </div>
        <div class="algorithm">
            <h2>堆排序</h2>
            <div id="heapSortArray" class="array-container"></div>
        </div>
    </div>

    <script>
    let arrays = {};
    let arraySize = 20;
    let animationSpeed = 500;

    function initArrays() {
        const arraySizeInput = document.getElementById('arraySize');
        arraySize = arraySizeInput ? parseInt(arraySizeInput.value) || 20 : 20;
        const baseArray = Array.from({length: arraySize}, () => Math.floor(Math.random() * 100) + 1);
        arrays = {
            quickSort: [...baseArray],
            bubbleSort: [...baseArray],
            insertionSort: [...baseArray],
            selectionSort: [...baseArray],
            mergeSort: [...baseArray],
            heapSort: [...baseArray]
        };
        updateVisualizations();
    }

    function updateVisualizations() {
        for (let [algorithm, arr] of Object.entries(arrays)) {
            const arrayContainer = document.getElementById(`${algorithm}Array`);
            if (arrayContainer) {
                arrayContainer.innerHTML = '';
                const maxVal = Math.max(...arr);
                arr.forEach(val => {
                    const bar = document.createElement('div');
                    bar.className = 'bar';
                    bar.style.height = `${(val / maxVal) * 100}%`;
                    const span = document.createElement('span');
                    span.textContent = val;
                    bar.appendChild(span);
                    arrayContainer.appendChild(bar);
                });
            }
        }
    }

    async function startSort() {
        const speedInput = document.getElementById('animationSpeed');
        animationSpeed = speedInput ? 1000 - parseInt(speedInput.value) || 500 : 500;
        const sortPromises = [
            quickSort(arrays.quickSort, 0, arrays.quickSort.length - 1),
            bubbleSort(arrays.bubbleSort),
            insertionSort(arrays.insertionSort),
            selectionSort(arrays.selectionSort),
            mergeSort(arrays.mergeSort, 0, arrays.mergeSort.length - 1),
            heapSort(arrays.heapSort)
        ];
        await Promise.all(sortPromises);
        markSorted();
    }

    function markSorted() {
        for (let algorithm of Object.keys(arrays)) {
            const arrayContainer = document.getElementById(`${algorithm}Array`);
            if (arrayContainer) {
                Array.from(arrayContainer.children).forEach(bar => {
                    bar.style.backgroundColor = '#2ecc71';
                });
            }
        }
    }

    async function quickSort(arr, low, high) {
        if (low < high) {
            let pi = await partition(arr, low, high);
            await quickSort(arr, low, pi - 1);
            await quickSort(arr, pi + 1, high);
        }
    }

    async function partition(arr, low, high) {
        let pivot = arr[high];
        let i = low - 1;
        for (let j = low; j <= high - 1; j++) {
            await updateArray('quickSort', [j, high], 'compare');
            if (arr[j] < pivot) {
                i++;
                [arr[i], arr[j]] = [arr[j], arr[i]];
                await updateArray('quickSort', [i, j], 'swap');
            }
        }
        [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
        await updateArray('quickSort', [i + 1, high], 'swap');
        return i + 1;
    }

    async function bubbleSort(arr) {
        let n = arr.length;
        for (let i = 0; i < n - 1; i++) {
            for (let j = 0; j < n - i - 1; j++) {
                await updateArray('bubbleSort', [j, j + 1], 'compare');
                if (arr[j] > arr[j + 1]) {
                    [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                    await updateArray('bubbleSort', [j, j + 1], 'swap');
                }
            }
        }
    }

    async function insertionSort(arr) {
        let n = arr.length;
        for (let i = 1; i < n; i++) {
            let key = arr[i];
            let j = i - 1;
            await updateArray('insertionSort', [i], 'compare');
            while (j >= 0 && arr[j] > key) {
                arr[j + 1] = arr[j];
                await updateArray('insertionSort', [j, j + 1], 'swap');
                j = j - 1;
            }
            arr[j + 1] = key;
            await updateArray('insertionSort');
        }
    }

    async function selectionSort(arr) {
        let n = arr.length;
        for (let i = 0; i < n - 1; i++) {
            let minIdx = i;
            for (let j = i + 1; j < n; j++) {
                await updateArray('selectionSort', [minIdx, j], 'compare');
                if (arr[j] < arr[minIdx]) {
                    minIdx = j;
                }
            }
            [arr[minIdx], arr[i]] = [arr[i], arr[minIdx]];
            await updateArray('selectionSort', [i, minIdx], 'swap');
        }
    }

    async function mergeSort(arr, l, r) {
        if (l >= r) {
            return;
        }
        let m = l + parseInt((r - l) / 2);
        await mergeSort(arr, l, m);
        await mergeSort(arr, m + 1, r);
        await merge(arr, l, m, r);
    }

    async function merge(arr, l, m, r) {
        let n1 = m - l + 1;
        let n2 = r - m;
        let L = new Array(n1);
        let R = new Array(n2);
        for (let i = 0; i < n1; i++) L[i] = arr[l + i];
        for (let j = 0; j < n2; j++) R[j] = arr[m + 1 + j];
        let i = 0, j = 0, k = l;
        while (i < n1 && j < n2) {
            await updateArray('mergeSort', [k], 'compare');
            if (L[i] <= R[j]) {
                arr[k] = L[i];
                i++;
            } else {
                arr[k] = R[j];
                j++;
            }
            await updateArray('mergeSort', [k], 'swap');
            k++;
        }
        while (i < n1) {
            arr[k] = L[i];
            await updateArray('mergeSort', [k], 'swap');
            i++;
            k++;
        }
        while (j < n2) {
            arr[k] = R[j];
            await updateArray('mergeSort', [k], 'swap');
            j++;
            k++;
        }
    }

    async function heapSort(arr) {
        let n = arr.length;
        for (let i = Math.floor(n / 2) - 1; i >= 0; i--)
            await heapify(arr, n, i);
        for (let i = n - 1; i > 0; i--) {
            [arr[0], arr[i]] = [arr[i], arr[0]];
            await updateArray('heapSort', [0, i], 'swap');
            await heapify(arr, i, 0);
        }
    }

    async function heapify(arr, n, i) {
        let largest = i;
        let l = 2 * i + 1;
        let r = 2 * i + 2;
        if (l < n && arr[l] > arr[largest])
            largest = l;
        if (r < n && arr[r] > arr[largest])
            largest = r;
        if (largest != i) {
            [arr[i], arr[largest]] = [arr[largest], arr[i]];
            await updateArray('heapSort', [i, largest], 'swap');
            await heapify(arr, n, largest);
        }
    }

    async function updateArray(algorithm, highlightIndices = [], operation = '') {
        const arrayContainer = document.getElementById(`${algorithm}Array`);
        if (arrayContainer) {
            const maxVal = Math.max(...arrays[algorithm]);
            Array.from(arrayContainer.children).forEach((bar, index) => {
                bar.style.height = `${(arrays[algorithm][index] / maxVal) * 100}%`;
                if (highlightIndices.includes(index)) {
                    bar.style.backgroundColor = operation === 'compare' ? '#f1c40f' : '#e74c3c';
                } else {
                    bar.style.backgroundColor = '#3498db';
                }
                bar.querySelector('span').textContent = arrays[algorithm][index];
            });
            await new Promise(resolve => setTimeout(resolve, animationSpeed));
        }
    }

    // 初始化数组
    document.addEventListener('DOMContentLoaded', initArrays);
    </script>
</body>
</html>