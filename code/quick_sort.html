<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>快速排序算法可视化</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            align-items: center;
            background-color: #f0f0f0;
            overflow: hidden;
        }
        header {
            background-color: #4CAF50;
            color: white;
            text-align: center;
            padding: 1em;
            width: 100%;
        }
        main {
            display: flex;
            flex: 1;
            width: 90%;
            max-width: 1200px;
            margin-top: 2em;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        #code, #visualization {
            flex: 1;
            padding: 2em;
            overflow: auto;
        }
        #code {
            background-color: #f8f8f8;
            border-radius: 10px 0 0 10px;
        }
        #visualization {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #array {
            display: flex;
            margin-bottom: 1em;
            height: 300px;
            align-items: flex-end;
        }
        .bar {
            margin: 0 2px;
            background-color: #3498db;
            transition: height 0.3s, width 0.3s, background-color 0.3s;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .bar-value {
            position: absolute;
            top: -20px;
            font-size: 12px;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1em;
            margin-top: 1em;
        }
        .control {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        label {
            margin-bottom: 0.5em;
            font-weight: bold;
        }
        input[type="number"], input[type="range"] {
            width: 100px;
        }
        button {
            font-size: 1em;
            padding: 0.5em 1em;
            margin-top: 1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        pre[class*="language-"] {
            margin: 0;
            border-radius: 0;
        }
        #legend {
            display: flex;
            justify-content: center;
            margin-top: 1em;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0 1em;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            margin-right: 0.5em;
        }
    </style>
</head>
<body>
    <header>
        <h1>快速排序算法可视化</h1>
    </header>
    <main>
        <section id="code">
            <pre><code class="language-javascript">
function quickSort(arr, low, high) {
    if (low < high) {
        let pi = partition(arr, low, high);
        quickSort(arr, low, pi - 1);
        quickSort(arr, pi + 1, high);
    }
}

function partition(arr, low, high) {
    let pivot = arr[high];
    let i = low - 1;
    for (let j = low; j < high; j++) {
        if (arr[j] < pivot) {
            i++;
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
    }
    [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
    return i + 1;
}
            </code></pre>
        </section>
        <section id="visualization">
            <div id="array"></div>
            <div id="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #3498db;"></div>
                    <span>未处理</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>基准元素</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f1c40f;"></div>
                    <span>比较元素</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>已排序</span>
                </div>
            </div>
            <div class="controls">
                <div class="control">
                    <label for="arraySize">数组大小</label>
                    <input type="number" id="arraySize" min="5" max="50" value="10">
                </div>
                <div class="control">
                    <label for="barWidth">条形宽度</label>
                    <input type="range" id="barWidth" min="2" max="50" value="30">
                </div>
                <div class="control">
                    <label for="animationSpeed">动画速度</label>
                    <input type="range" id="animationSpeed" min="1" max="1000" value="500">
                </div>
            </div>
            <div>
                <button onclick="generateArray()">生成新数组</button>
                <button onclick="startVisualization()">开始排序</button>
            </div>
        </section>
    </main>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-javascript.min.js"></script>
    <script>
        let array = [];
        let arrayBars = [];
        let animationSpeed = 500;
        let barWidth = 30;

        function generateArray() {
            const arraySize = parseInt(document.getElementById('arraySize').value);
            array = Array.from({length: arraySize}, () => Math.floor(Math.random() * 100) + 1);
            updateVisualization();
        }

        function updateVisualization() {
            const arrayContainer = document.getElementById('array');
            arrayContainer.innerHTML = '';
            arrayBars = [];
            const maxValue = Math.max(...array);
            for (let num of array) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                const height = (num / maxValue) * 280;
                bar.style.height = `${height}px`;
                bar.style.width = `${barWidth}px`;
                const valueDisplay = document.createElement('span');
                valueDisplay.className = 'bar-value';
                valueDisplay.textContent = num;
                bar.appendChild(valueDisplay);
                arrayContainer.appendChild(bar);
                arrayBars.push(bar);
            }
        }

        async function startVisualization() {
            await quickSortVisualization(0, array.length - 1);
            arrayBars.forEach(bar => bar.style.backgroundColor = '#2ecc71');
        }

        async function quickSortVisualization(low, high) {
            if (low < high) {
                let pi = await partitionVisualization(low, high);
                await quickSortVisualization(low, pi - 1);
                await quickSortVisualization(pi + 1, high);
            }
        }

        async function partitionVisualization(low, high) {
            let pivot = array[high];
            arrayBars[high].style.backgroundColor = '#e74c3c'; // 红色，基准元素
            let i = low - 1;
            for (let j = low; j < high; j++) {
                arrayBars[j].style.backgroundColor = '#f1c40f'; // 黄色，当前比较元素
                await sleep(animationSpeed);
                if (array[j] < pivot) {
                    i++;
                    arrayBars[i].style.backgroundColor = '#f1c40f'; // 黄色，将要交换的元素
                    await sleep(animationSpeed);
                    [array[i], array[j]] = [array[j], array[i]];
                    [arrayBars[i].style.height, arrayBars[j].style.height] = 
                    [arrayBars[j].style.height, arrayBars[i].style.height];
                    [arrayBars[i].querySelector('.bar-value').textContent, 
                     arrayBars[j].querySelector('.bar-value').textContent] = 
                    [arrayBars[j].querySelector('.bar-value').textContent, 
                     arrayBars[i].querySelector('.bar-value').textContent];
                    await sleep(animationSpeed);
                    arrayBars[i].style.backgroundColor = '#3498db'; // 蓝色，恢复未处理状态
                }
                arrayBars[j].style.backgroundColor = '#3498db'; // 蓝色，恢复未处理状态
            }
            arrayBars[i + 1].style.backgroundColor = '#f1c40f'; // 黄色，将要与基准元素交换的元素
            await sleep(animationSpeed);
            [array[i + 1], array[high]] = [array[high], array[i + 1]];
            [arrayBars[i + 1].style.height, arrayBars[high].style.height] = 
            [arrayBars[high].style.height, arrayBars[i + 1].style.height];
            [arrayBars[i + 1].querySelector('.bar-value').textContent, 
             arrayBars[high].querySelector('.bar-value').textContent] = 
            [arrayBars[high].querySelector('.bar-value').textContent, 
             arrayBars[i + 1].querySelector('.bar-value').textContent];
            arrayBars[high].style.backgroundColor = '#3498db'; // 蓝色，恢复未处理状态
            arrayBars[i + 1].style.backgroundColor = '#2ecc71'; // 绿色，已排序状态
            await sleep(animationSpeed);
            return i + 1;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        document.getElementById('animationSpeed').addEventListener('input', function() {
            animationSpeed = 1000 - this.value + 1;
        });

        document.getElementById('barWidth').addEventListener('input', function() {
            barWidth = parseInt(this.value);
            updateVisualization();
        });

        generateArray();
    </script>
</body>
</html>